"------------------------------------------------------------------------------------------------------------------------------------------
"------------------------------------------------READ TABLE TUTORIAL-----------------------------------------------------------------------
"------------------------------------------------------------------------------------------------------------------------------------------
REPORT ZTEST2.

*" Transparent Table - ZPAYROLL
*"-------------------------------------------------------------------------------
*"-------------------------------------------------------------------------------
*"
*" [FIELD]     [KEY]   [DATA ELEMENT]    [DATA TYPE]    [LENGTH]    [SHORT DESCRIPTION]
*" MANDT         X         MANDT            CLNT           3               Client
*" ID            X         ZID              INT1           3               Id Employee
*" BRUTESAL                ZBRUTESAL        DEC            6               Brute Salary
*" LIQSAL                  ZLIQSAL          DEC            6               Liquid Salary
*" HEALTHPLAN              ZHEALTHPLAN      CHAR           1               Health Plan
*" SINDICAL                ZSINDICAL        CHAR           1               Sindical Services
*" TRANSPORT               ZTRANSPORT       CHAR           1               Ticket Transport
*" EXTRAHOUR               ZEXTRAHOUR       INT1           3               Extra Hour
*" DEDUCTIONS              ZDEDUCTIONS      DEC            6               Deductions
*" SECSOCIAL               ZSECOSCIAL       DEC            6               Security Social
*" IRS                     ZIRS             DEC            6               IRS
*" BONUS                   ZBONUS           DEC            6               Bonus
*" SUBHOLYDAYS             ZSUBHOLYDAYS     DEC            1               Holydays
*" NOPAYLEAVE              ZNOPAYLEAVE      INT1           3               No Pay Leave
*" WORKSHIFT               ZWORKSHIFT       CHAR           5               Work Shift
*"
*"-------------------------------------------------------------------------------
*"-------------------------------------------------------------------------------

DATA: LT_TABLE TYPE TABLE OF ZPAYROLL, "DECLARACAO DE TABELA INTERNA."
      LS_STRUCT TYPE ZPAYROLL,         "DECLARACAO DE ESTRUTURA."
      LV_INDEX TYPE I.                 "DECLARACAO DE VARIAVEL NUMERICA PARA RECEBER O VALOR DE UM ÍNDICE."

LV_INDEX = 2. "VALOR DO ÍNDICE RECEBE 2."

SELECT * FROM ZPAYROLL INTO TABLE LT_TABLE. "TODOS OS DADOS DA TABELA TRANSPARENTE SAO SELECIONADOS E INSERIDOS NA TABELA INTERNA."

"------------------------------------------------------------------------------------------------------------------------------------------
"------------------------------------------------------------------------------------------------------------------------------------------
"[LER ENTRADA POR UMA CHAVE]"
READ TABLE LT_TABLE INTO LS_STRUCT WITH KEY ID = 16.    "LER A LINHA DA TABELA INTERNA ONDE O ID É 1."

IF SY-SUBRC = 0.                                        "SE A INTRUÇÃO FOR BEM SUCEDIDA...
  WRITE LS_STRUCT-DEDUCTIONS.                           "ESCREVA O VALOR DAS DEDUCOES SALARIAIS ONDE A LINHA FOI INSERIDA NA ESTRUTURA."
ELSE.                                                   "DO CONTRÁRIO...
  WRITE 'AS DEDUÇÕES SALARIAIS NÃO FORAM ENCONTRADAS.'. "ESCREVA A MENSAGEM."
ENDIF.                                                  "ENCERRA ESTRUTURA DE CONTROLE."

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------
"[LER A PRIMEIRA ENTRADA]"
READ TABLE LT_TABLE INTO LS_STRUCT INDEX 1.             "LER O PRIMEIRO ELEMENTO DA TABELA TRATANDO-A COMO UM ARRAY."

IF SY-SUBRC = 0.                                        "SE A INTRUÇÃO FOR BEM SUCEDIDA...
  WRITE LS_STRUCT-DEDUCTIONS.                           "ESCREVA O VALOR DAS DEDUCOES SALARIAIS ONDE A LINHA FOI INSERIDA NA ESTRUTURA."
ELSE.                                                   "DO CONTRÁRIO...
  WRITE 'AS DEDUÇÕES SALARIAIS NÃO FORAM ENCONTRADAS.'. "ESCREVA A MENSAGEM."
ENDIF.                                                  "ENCERRA ESTRUTURA DE CONTROLE."

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------
"[LER A ENTRADA POR ÍNDICE NUMÉRICO]"
READ TABLE LT_TABLE INTO LS_STRUCT INDEX LV_INDEX.      "LER O PRIMEIRO ELEMENTO DA TABELA TRATANDO-A COMO UM ARRAY."

IF SY-SUBRC = 0.                                        "SE A INTRUÇÃO FOR BEM SUCEDIDA...
  WRITE LS_STRUCT-DEDUCTIONS.                           "ESCREVA O VALOR DAS DEDUCOES SALARIAIS ONDE A LINHA FOI INSERIDA NA ESTRUTURA."
ELSE.                                                   "DO CONTRÁRIO...
  WRITE 'AS DEDUÇÕES SALARIAIS NÃO FORAM ENCONTRADAS.'. "ESCREVA A MENSAGEM."
ENDIF.                                                  "ENCERRA ESTRUTURA DE CONTROLE."

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------
"[LER A ENTRADA POR PESQUISA BINÁRIA]"
READ TABLE LT_TABLE INTO LS_STRUCT WITH KEY ID = '2' BINARY SEARCH. "LER A LINHA DA TABELA INTERNA ONDE O ID É 2 USANDO PESQUISA BINÁRIA."

IF SY-SUBRC = 0.                                                    "SE A INTRUÇÃO FOR BEM SUCEDIDA...
  WRITE LS_STRUCT-DEDUCTIONS.                                       "ESCREVA O VALOR DAS DEDUCOES SALARIAIS ONDE A LINHA FOI INSERIDA NA ESTRUTURA."
ELSE.                                                               "DO CONTRÁRIO...
  WRITE / 'AS DEDUÇÕES SALARIAIS NÃO FORAM ENCONTRADAS.'.           "ESCREVA A MENSAGEM."
ENDIF.                                                              "ENCERRA ESTRUTURA DE CONTROLE."

SKIP 1.

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------

"[EXERCÍCIO: GERENCIAMENTO DE FOLHA DE PAGAMENTO]"

"VOCÊ FOI ENCARREGADO DE DESENVOLVER UM PROGRAMA ABAP PARA GERENCIAR OS DADOS DE FOLHA DE PAGAMENTO
"DE UMA EMPRESA UTILIZANDO INFORMAÇÕES DA TABELA PAYROLL.
"ESTA TABELA CONTÉM INFORMAÇÕES BÁSICAS SOBRE OS FUNCIONáRIOS, INCLUINDO DADOS
"RELEVANTES PARA A FOLHA DE PAGAMENTO.

"SEU PROGRAMA DEVE SER CAPAZ DE EXECUTAR AS SEGUINTES TAREFAS:

"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONÁRIO COM O MAIOR NUMERO DE ID MENOR DO QUE 100."
"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NúMERO DE PESSOAL íMPAR MAIS PRóXIMO DE 100.
"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NúMERO DE PESSOAL PAR MAIS PRóXIMO DO PRIMEIRO FUNCIONáRIO NA TABELA.
"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NúMERO DE PESSOAL íMPAR MAIS PRóXIMO DO PRIMEIRO FUNCIONáRIO NA TABELA.
"REALIZAR UMA PESQUISA BINÁRIA PARA ENCONTRAR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NÚMERO DE PESSOAL PAR MAIS PRÓXIMO DE 50 E EXIBI-LAS.
"REALIZAR UMA PESQUISA BINÁRIA PARA ENCONTRAR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NÚMERO DE PESSOAL íMPAR MAIS PRÓXIMO DE 50 E EXIBI-LAS.
"CERTIFIQUE-SE DE LIDAR ADEQUADAMENTE COM CASOS EM QUE OS DADOS NãO SãO ENCONTRADOS E CONSIDERE A EFICIêNCIA DO ALGORITMO AO REALIZAR AS OPERAÇÕES DE PESQUISA BINÁRIA.

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------

"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONÁRIO COM O MAIOR NUMERO DE ID MENOR DO QUE 100."

DATA: LT_TABLE2 TYPE TABLE OF ZPAYROLL, "TABELA INTERNA DO TIPO DA TABELA TRANSPARENTE DE PAYROLL."
      LS_STRUCT2 TYPE ZPAYROLL,         "ESTRUTURA LOCAL DO TIPO DA TABELA TRANSPARENTE DE PAYROLL."
      MAXID TYPE ZID.                   "VARIÁVEL PARA PEGAR O VALOR MÁXIMO DO ID."

SELECT * FROM ZPAYROLL INTO TABLE LT_TABLE2. "SELECIONA TODOS OS DADOS DA TABELA TRANSPARENTE PAYROLL E INSERE NA TABELA INTERNA."
SELECT MAX( ID ) FROM ZPAYROLL INTO MAXID.   "SELECIONA O MAIOR VALOR DO ID NA TABELA TRANSPARENTE E INSERE NA VARIÁVEL."

READ TABLE LT_TABLE2 INTO LS_STRUCT2 WITH KEY ID = MAXID. "PROCURA NA TABELA INTERNA O VALOR DA VARIÁVEL NA COLUNA ID."

IF SY-SUBRC = 0.                                                                                                    "SE A INSTRUÇÃO FOR BEM SUCEDIDA...
  IF MAXID >= 100.                                                                                                  "E SE A VARIÁVEL FOR MENOR OU IGUAL A 100...
    WRITE / 'NÃO FOI POSSÍVEL ENCONTRAR OS DADOS SOLICITADOS.'.                                                     "EXIBE A MENSAGEM."
  ELSE.                                                                                                             "DO CONTRÁRIO...
    WRITE: / 'DEDUÇÂO SALARIAL DO FUNCIONáRIO', LS_STRUCT2-ID,'->', LS_STRUCT2-DEDUCTIONS,'€'. "EXIBE A MENSAGEM."  "EXIBE A MENSAGEM."
  ENDIF.                                                                                                            "ENCERRA ESTRUTURA DE CONTROLE."
ELSE.                                                                                                               "SE NÃO ACHAR ID NA TABELA INTERNA."
  WRITE / 'NÃO EXISTE ID NA TABELA.'.                                                                               "EXIBE A MENSAGEM."
ENDIF.                                                                                                              "ENCERRA ESTRUTURA DE CONTROLE."

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------

"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O MAIOR ID íMPAR MENOR DO QUE 100.

DATA: ODDNUM TYPE ZID,              "VARIÁVEL NUMÉRICA DO TIPO DO ID DA TABELA TRANSPARENTE."
      INDEX TYPE ZID,               "VARIÁVEL NUMÉRICA PARA RECEBER O COMEÇO DE UM ÍNDICE."
      ENDINDEX TYPE ZID,            "VARIÁVEL NUMÉRICA PARA RECEBER O FINAL DE UM ÍNDICE."
      DEDUCTIONS1 TYPE ZDEDUCTIONS. "VARIÁVEL PARA RECEBER O VALOR DAS DEDUÇÕES SALARIAIS."

TYPES: BEGIN OF GS_STRUCT3,            "CRIAÇÃO DE ESTRUTURA TYPES."
          ID TYPE ZID,                 "ID DA ESTRUTURA RECEBE O TIPO DO ID DA TABELA TRANSPARENTE."
          DEDUCTIONS TYPE ZDEDUCTIONS, "DEDUCOES DA ESTRUTURA RECEBE O TIPO DE DEDUCOES DA TABELA TRANSPARENTE."
       END OF GS_STRUCT3.              "ENCERRAMENTO DA ESTRUTURA."

DATA: LT_TABLE3 TYPE TABLE OF GS_STRUCT3, "TABELA INTERNA DO TIPO DA ESTRUTURA TYPES."
      LS_STRUCT3 LIKE LINE OF LT_TABLE3.  "ESTRUTURA LOCAL DO TIPO LINHA DA MINHA TABELA INTERNA.
                                          "ESTRUTURA LOCAL TAMBÉM PODERIA SER DO TIPO DA ESTRUTURA TYPES."

ODDNUM = INDEX MOD 2. "VARIÁVEL RECEBE O RESTO DO ID DIVIDIDO POR 2."

SELECT ID DEDUCTIONS FROM ZPAYROLL INTO TABLE LT_TABLE3.                "SELECIONA TODOS OS DADOS DA COLUNA ID E DEDUCTIONS DA TABELA TRANSPARENTE E INSERE NA TABELA INTERNA."
                                                                        "OU...
SELECT ID, DEDUCTIONS FROM ZPAYROLL INTO TABLE @DATA(LT_TABLE4_INLINE). "COMANDO INLINE DISPENSA A CRIAÇÃO DA ESTRUTURA TYPES E DA TABELA INTERNA, DECLARANDO UMA TABELA INTERNA DINÂMICA QUE SE ACOMODA A INSERÇÃO DOS DADOS."

SELECT MIN( ID ) FROM ZPAYROLL INTO INDEX.    "SELECIONA O MENOR NUMERO DA COLUNA ID DA TABELA TRANSPARENTE E O INSERE NA VARIÁVEL.
SELECT MAX( ID ) FROM ZPAYROLL INTO ENDINDEX. "SELECIONA O MAIOR NÚMERO DA COLUNA ID DA TABELA TRANSPARENTE E O INSERE NA VARIÁVEL.

SORT LT_TABLE3 BY ID. "ORDENA A TABELA INTERNA POR ID."

WHILE INDEX < ENDINDEX.                             "ENQUANTO NÃO CHEGAR AO FIM DA TABELA...
  READ TABLE LT_TABLE3 INTO LS_STRUCT3 INDEX INDEX. "ITERA NA TABELA INTERNA RECEBENDO O VALOR DO INDEX."
  INDEX = INDEX + 1.                                "INCREMENTA O INDEX."
  IF INDEX MOD 2 NE 0.                              "SE O INDEX FOR ÍMPAR."
    DEDUCTIONS1 = LS_STRUCT3-DEDUCTIONS.            "VARIÁVEL RECEBE O VALOR DAS DEDUÇÕES SALARIAIS."
  ENDIF.                                            "ENCERRA ESTRUTURA DE CONTROLE."
ENDWHILE.                                           "ENCERRA O CICLO."

 WRITE: / 'DEDUÇÂO SALARIAL DO FUNCIONáRIO', LS_STRUCT3-ID,'->', LS_STRUCT3-DEDUCTIONS,'€'. "EXIBE A MENSAGEM."

"-------------------------------------------------------------------------------------------------------------------------------------------
"-------------------------------------------------------------------------------------------------------------------------------------------

"LER E EXIBIR AS DEDUÇÕES SALARIAIS DO FUNCIONáRIO COM O NúMERO ID PAR MAIS PRóXIMO DO PRIMEIRO FUNCIONÁRIO NA TABELA.

SELECT ID, DEDUCTIONS FROM ZPAYROLL INTO TABLE @DATA(LT_TABLE4).

DATA: LS_STRUCT4 LIKE LINE OF LT_TABLE4,
      INDEX2 TYPE ZID,
      ENDINDEX2 TYPE ZID,
      EVENUM TYPE ZID.

EVENUM = 2 MOD 2.

SORT LT_TABLE4 BY ID DESCENDING.

SELECT MAX( ID ) INTO INDEX2 FROM ZPAYROLL.
SELECT MIN( ID ) INTO ENDINDEX2 FROM ZPAYROLL.
